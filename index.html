<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>שאלון משוב - המכון הישראלי לבינה מלאכותית (IIAI)</title>
    <!-- טעינת Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* הגדרת פונט Inter כברירת מחדל */
        :root {
            --font-inter: 'Inter', sans-serif;
        }
        body {
            font-family: var(--font-inter);
            direction: rtl; /* כיווניות מימין לשמאל */
        }
        /* סגנון לשאלות בחירה (Radio buttons) */
        .custom-radio input:checked + label {
            background-color: #00A3FF; /* צבע הדגשה כחול */
            color: #FFFFFF;
            border-color: #00A3FF;
        }
        .custom-radio label {
            transition: all 0.2s;
            cursor: pointer;
        }
        /* עיצוב עבור כוכב בדירוג */
        .rating-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 sm:p-8">

    <!-- טעינת ספריות Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // הגדרות כלליות
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let userId = null;
        let isAuthReady = false;

        // --- פונקציות עזר ל-UI ---
        const ui = {
            form: document.getElementById('feedback-form'),
            submitButton: document.getElementById('submit-feedback'),
            messageBox: document.getElementById('message-box'),
            feedbackContainer: document.getElementById('feedback-container'),
            successModal: document.getElementById('success-modal'),
            closeModalButton: document.getElementById('close-modal-btn')
        };

        function showErrorMessage(message) {
            ui.messageBox.innerHTML = `
                <div class="p-4 rounded-lg shadow-xl text-center bg-red-600 text-white">
                    ${message}
                </div>
            `;
            ui.messageBox.classList.remove('hidden');
        }

        function showSuccessModal() {
            ui.successModal.classList.remove('hidden');
            // הסתרת הטופס
            ui.feedbackContainer.classList.add('hidden');
        }

        // סגירת המודאל בלחיצה על הכפתור
        ui.closeModalButton?.addEventListener('click', () => {
            ui.successModal.classList.add('hidden');
        });

        // --- אתחול Firebase ואימות משתמש ---
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing.");
                    showErrorMessage('שגיאת מערכת: הגדרות Firebase חסרות.');
                    return;
                }
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // ודא שמסד הנתונים מוגדר למצב Debug
                setLogLevel('debug'); 

                if (initialAuthToken) {
                    const userCredential = await signInWithCustomToken(auth, initialAuthToken);
                    userId = userCredential.user.uid;
                } else {
                    const userCredential = await signInAnonymously(auth);
                    userId = userCredential.user.uid;
                }
                isAuthReady = true;
                console.log("Firebase initialized. User ID:", userId);

            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
                showErrorMessage('שגיאה באתחול. נסה לרענן את העמוד.');
            }
        }

        // --- טיפול בשליחת הטופס ---
        ui.form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!isAuthReady) {
                showErrorMessage('המערכת עדיין בטעינה. אנא המתן רגע ונסה שוב.');
                return;
            }

            ui.submitButton.disabled = true;
            ui.submitButton.textContent = 'שולח...';
            ui.messageBox.classList.add('hidden'); // הסתרת הודעות שגיאה קודמות

            try {
                // איסוף נתוני הטופס
                const formData = new FormData(ui.form);
                const data = {
                    userId: userId, 
                    timestamp: new Date().toISOString(),
                    // שאלות בחירה (Radio)
                    q1_rating: formData.get('q1_rating'),
                    q4_tools_applied: formData.get('q4_tools_applied'),
                    q6_recommend: formData.get('q6_recommend'),
                    // שאלות טקסט חופשי
                    q2_reason: formData.get('q2_reason').trim(),
                    q3_significant: formData.get('q3_significant').trim(),
                    q5_suitable_for: formData.get('q5_suitable_for').trim(),
                    q7_improve: formData.get('q7_improve').trim(),
                    q8_next_topic: formData.get('q8_next_topic').trim(),
                };

                // בדיקת שדות חובה
                if (!data.q1_rating || !data.q4_tools_applied || !data.q6_recommend) {
                     showErrorMessage('אנא מלא את כל שאלות הבחירה לפני השליחה.');
                     ui.submitButton.disabled = false;
                     ui.submitButton.textContent = 'שלח משוב';
                     return;
                }
                
                // נתיב ציבורי לאוסף המשוב
                const feedbackCollectionRef = collection(db, `artifacts/${appId}/public/data/workshopFeedback`);
                
                await addDoc(feedbackCollectionRef, data);
                
                // הצגת המודאל
                showSuccessModal();
                
            } catch (e) {
                console.error("Error adding document: ", e);
                showErrorMessage('אירעה שגיאה בשליחת המשוב. אנא נסה/י שוב.');
            } finally {
                ui.submitButton.disabled = false;
                if (!ui.feedbackContainer.classList.contains('hidden')) {
                    ui.submitButton.textContent = 'שלח משוב';
                }
            }
        });

        // אתחול
        initializeFirebase();
    </script>

    <!-- קונטיינר ראשי -->
    <div class="max-w-3xl mx-auto bg-gray-800 p-6 sm:p-10 rounded-xl shadow-2xl">
        
        <!-- כותרת ופתיחה -->
        <h1 class="text-3xl sm:text-4xl font-extrabold text-white mb-3 text-center">שאלון משוב - הסדנה שלנו</h1>
        <p class="text-lg text-gray-400 mb-8 text-center">
            זה יקח לך רק 2-3 דקות, ונשמח מאוד לשמוע ממך! 💙
        </p>

        <!-- הודעות מערכת (שגיאה בלבד) -->
        <div id="message-box" class="mb-6 hidden"></div>

        <!-- טופס המשוב הראשי -->
        <div id="feedback-container">
            <form id="feedback-form" class="space-y-8">
                
                <!-- 1. דירוג ציפיות -->
                <div class="space-y-3 p-4 bg-gray-700 rounded-lg shadow-lg">
                    <label class="block text-xl font-bold text-white mb-4" for="q1">1. באיזו מידה הסדנה עמדה בציפיות שלך? ⭐</label>
                    <div class="flex flex-col sm:flex-row justify-between custom-radio text-center text-sm sm:text-base gap-3">
                        
                        <!-- שדות רדיו עם תצוגת מובייל משופרת (רוחב מלא במובייל) -->
                        <input type="radio" id="q1_1" name="q1_rating" value="1" class="hidden" required>
                        <label for="q1_1" class="p-3 w-full sm:w-1/5 border-2 border-gray-600 rounded-lg hover:bg-gray-600/50 rating-label">1 - בכלל לא</label>

                        <input type="radio" id="q1_2" name="q1_rating" value="2" class="hidden" required>
                        <label for="q1_2" class="p-3 w-full sm:w-1/5 border-2 border-gray-600 rounded-lg hover:bg-gray-600/50 rating-label">2</label>

                        <input type="radio" id="q1_3" name="q1_rating" value="3" class="hidden" required>
                        <label for="q1_3" class="p-3 w-full sm:w-1/5 border-2 border-gray-600 rounded-lg hover:bg-gray-600/50 rating-label">3</label>

                        <input type="radio" id="q1_4" name="q1_rating" value="4" class="hidden" required>
                        <label for="q1_4" class="p-3 w-full sm:w-1/5 border-2 border-gray-600 rounded-lg hover:bg-gray-600/50 rating-label">4</label>

                        <input type="radio" id="q1_5" name="q1_rating" value="5" class="hidden" required>
                        <label for="q1_5" class="p-3 w-full sm:w-1/5 border-2 border-gray-600 rounded-lg hover:bg-gray-600/50 rating-label">5 - מעבר לציפיות!</label>

                    </div>
                </div>

                <!-- 2. למה נרשמת לסדנה? -->
                <div>
                    <label class="block text-xl font-bold text-white mb-2" for="q2_reason">2. למה בעצם נרשמת לסדנה? 🤔</label>
                    <input type="text" id="q2_reason" name="q2_reason" placeholder='לדוגמה: "רציתי ללמוד איך לבנות אתר" / "המלצה מחבר" / "רציתי לקדם את העסק"'
                           class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500" />
                </div>

                <!-- 3. הדבר הכי משמעותי שלמדת -->
                <div>
                    <label class="block text-xl font-bold text-white mb-2" for="q3_significant">3. מה הדבר הכי משמעותי שלמדת או קיבלת מהסדנה? 🎯</label>
                    <textarea id="q3_significant" name="q3_significant" rows="3" placeholder="אנא כתוב 2-3 משפטים"
                              class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
                </div>
                
                <!-- 4. יישום כלים -->
                <div class="space-y-3 p-4 bg-gray-700 rounded-lg shadow-lg">
                    <label class="block text-xl font-bold text-white mb-4" for="q4">4. האם קיבלת כלים שאתה יכול/ה ליישם מיד?</label>
                    <div class="custom-radio space-y-2">
                        <div class="flex items-center">
                            <input type="radio" id="q4_a" name="q4_tools_applied" value="כן, בהחלט" class="hidden" required>
                            <label for="q4_a" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">כן, בהחלט! יש לי בדיוק מה צריך 💪</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="q4_b" name="q4_tools_applied" value="כן, חלקית" class="hidden" required>
                            <label for="q4_b" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">כן, חלקית - יש מה לעבוד איתו</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="q4_c" name="q4_tools_applied" value="לא בטוח" class="hidden" required>
                            <label for="q4_c" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">לא בטוח/ה עדיין</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="q4_d" name="q4_tools_applied" value="לא ממש" class="hidden" required>
                            <label for="q4_d" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">לא ממש</label>
                        </div>
                    </div>
                </div>

                <!-- 5. למי תתאים הסדנה -->
                <div>
                    <label class="block text-xl font-bold text-white mb-2" for="q5_suitable_for">5. למי לדעתך הסדנה הזאת תתאים במיוחד? 👥</label>
                    <input type="text" id="q5_suitable_for" name="q5_suitable_for" placeholder='לדוגמה: "למי שמתחיל בתחום" / "לבעלי עסקים קטנים" / "למי שרוצה לעשות קריירה"'
                           class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500" />
                </div>
                
                <!-- 6. המלצה לחבר -->
                <div class="space-y-3 p-4 bg-gray-700 rounded-lg shadow-lg">
                    <label class="block text-xl font-bold text-white mb-4" for="q6">6. האם תמליץ/י על הסדנה לחבר או עמית?</label>
                    <div class="custom-radio space-y-2">
                        <div class="flex items-center">
                            <input type="radio" id="q6_a" name="q6_recommend" value="בהחלט אמליץ" class="hidden" required>
                            <label for="q6_a" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">בהחלט אמליץ! 🌟</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="q6_b" name="q6_recommend" value="כן, אמליץ" class="hidden" required>
                            <label for="q6_b" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">כן, אמליץ</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="q6_c" name="q6_recommend" value="אולי" class="hidden" required>
                            <label for="q6_c" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">אולי</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="q6_d" name="q6_recommend" value="לא" class="hidden" required>
                            <label for="q6_d" class="p-3 w-full border-2 border-gray-600 rounded-lg hover:bg-gray-600/50">לא</label>
                        </div>
                    </div>
                </div>

                <!-- 7. מה היית משפר/משנה (אופציונלי) -->
                <div>
                    <label class="block text-xl font-bold text-white mb-2" for="q7_improve">7. יש משהו שהיית משפר/ת או משנה בסדנה? 🛠️</label>
                    <textarea id="q7_improve" name="q7_improve" rows="2" placeholder="לא חייבים למלא - אבל נשמח לשמוע!"
                              class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
                </div>
                
                <!-- 8. נושא לסדנה נוספת (אופציונלי) -->
                <div>
                    <label class="block text-xl font-bold text-white mb-2" for="q8_next_topic">8. (אופציונלי) על איזה נושא היית רוצה סדנה נוספת? 💡</label>
                    <input type="text" id="q8_next_topic" name="q8_next_topic" placeholder="לדוגמה: Prompt Engineering מתקדם / AI לעיצוב גרפי"
                           class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500" />
                </div>
                
                <!-- כפתור שליחה -->
                <button type="submit" id="submit-feedback"
                        class="w-full py-4 px-4 bg-green-500 hover:bg-green-600 text-gray-900 font-extrabold text-xl rounded-xl transition duration-200 shadow-lg shadow-green-500/30">
                    שלח משוב
                </button>
            </form>
        </div>
    </div>

    <!-- Success Modal Popup -->
    <div id="success-modal" class="fixed inset-0 bg-gray-900 bg-opacity-90 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl max-w-sm w-full text-center border-t-4 border-green-500 transform scale-100 transition-transform duration-300">
            <!-- אייקון V גדול -->
            <svg class="mx-auto h-16 w-16 text-green-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-3xl font-extrabold text-white mb-3">תודה ענקית! 🙏</h2>
            <p class="text-lg text-gray-300 mb-6">המשוב שלך התקבל בהצלחה.</p>
            <p class="text-md text-gray-400">הקדשת הזמן שלך יקרת ערך ועוזרת לנו לשפר את הסדנאות שלנו ב-IIAI. ניפגש בסדנה הבאה!</p>
            <button id="close-modal-btn" class="mt-6 w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition duration-150 shadow-md">
                סגור
            </button>
        </div>
    </div>
</body>
</html>
